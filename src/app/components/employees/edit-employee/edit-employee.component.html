<div class="container mx-auto mt-8 px-4">
  <div class="flex items-center mb-4">
    <i class='bx bxs-edit-alt text-4xl text-gray-600 mr-4'></i>
    <h1 class="text-2xl font-bold">Editar empleado</h1>
  </div>
  <hr class="my-4 border border-gray-400 w-full">
  <form [formGroup]="employeeForm" (ngSubmit)="updateEmployee()" enctype="multipart/form-data">
    <div class="container mx-auto mt-8 px-8 flex flex-col lg:flex-row gap-4">
      <!-- personal information -->
      <div class="flex-1 lg:mr-4 mb-4 lg:mb-0">
        <div class="border border-black p-4 rounded-lg bg-white">
          <h2 class="text-lg font-bold">Información personal</h2>
          <hr class="my-2 border-gray-400">

          <div class="mt-2">
            <label for="name" class="block">Nombre completo</label>
            <input type="text" id="name" formControlName="name" name="name"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Nombre" maxlength="60">
            <div
              *ngIf="employeeForm.get('name')?.errors?.['required'] && (employeeForm.get('name')?.dirty || employeeForm.get('name')?.touched)"
              class="text-red-500 mt-2">Nombre es obligatorio.</div>
            <div
              *ngIf="employeeForm.get('name')?.errors?.['pattern'] && (employeeForm.get('name')?.dirty || employeeForm.get('name')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce solo letras para el nombre.</div>
          </div>
          <div class="mt-2">
            <label for="surname" class="block">Apellido</label>
            <input type="text" id="surname" formControlName="surname" name="surname"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Apellidos" maxlength="60">
            <div
              *ngIf="employeeForm.get('surname')?.errors?.['required'] && (employeeForm.get('surname')?.dirty || employeeForm.get('surname')?.touched)"
              class="text-red-500 mt-2">Apellido es obligatorio.</div>
            <div
              *ngIf="employeeForm.get('surname')?.errors?.['pattern'] && (employeeForm.get('surname')?.dirty || employeeForm.get('surname')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce solo letras para el apellido.</div>
          </div>
          <div class="mt-2">
            <label for="date_of_birth" class="block">Fecha de nacimiento</label>
            <input type="date" id="date_of_birth" formControlName="date_of_birth" name="date_of_birth"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Fecha de nacimiento">
            <div
              *ngIf="employeeForm.get('date_of_birth')?.errors?.['required'] && (employeeForm.get('date_of_birth')?.dirty || employeeForm.get('date_of_birth')?.touched)"
              class="text-red-500 mt-2">Fecha de nacimiento es obligatoria.</div>
            <div
              *ngIf="employeeForm.get('date_of_birth')?.errors?.['invalidAgeOrDate'] && (employeeForm.get('date_of_birth')?.dirty || employeeForm.get('date_of_birth')?.touched)"
              class="text-red-500 mt-2">Debes tener al menos 18 años.</div>
            <div
              *ngIf="employeeForm.get('date_of_birth')?.errors?.['invalidDateInThePast'] && (employeeForm.get('date_of_birth')?.dirty || employeeForm.get('date_of_birth')?.touched)"
              class="text-red-500 mt-2">La fecha no puede ser tan antigua.</div>
          </div>
          <div class="mt-2">
            <label for="country" class="block">Pais</label>
            <input type="text" id="nacionalidad" formControlName="country" name="country"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Nacionalidad"
              maxlength="120">
            <div
              *ngIf="employeeForm.get('country')?.errors?.['required'] && (employeeForm.get('country')?.dirty || employeeForm.get('country')?.touched)"
              class="text-red-500 mt-2">Pais es obligatorio.</div>
              <div
              *ngIf="employeeForm.get('country')?.errors?.['pattern'] && (employeeForm.get('country')?.dirty || employeeForm.get('country')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce un país correcto</div>
          </div>
          <div class="mt-2">
            <label for="gender" class="block">Género</label>
            <select id="gender" formControlName="gender" name="gender"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner">
              <option value="" disabled selected>Seleccione su género</option>
              <option value="male">Masculino</option>
              <option value="female">Femenino</option>
            </select>
            <div
              *ngIf="employeeForm.get('gender')?.errors?.['required'] && (employeeForm.get('gender')?.dirty || employeeForm.get('gender')?.touched)"
              class="text-red-500 mt-2">Género es obligatorio.</div>
          </div>
          <div class="mt-2">
            <label for="email" class="block">Email</label>
            <input type="email" id="email" formControlName="email"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Email" maxlength="40">
            <div
              *ngIf="employeeForm.get('email')?.errors?.['required'] && (employeeForm.get('email')?.dirty || employeeForm.get('email')?.touched)"
              class="text-red-500 mt-2">Email es obligatorio.</div>
            <div
              *ngIf="employeeForm.get('email')?.errors?.['pattern'] && (employeeForm.get('email')?.dirty || employeeForm.get('email')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce un formato de correo electrónico válido.</div>
          </div>
          <div class="mt-2">
            <label for="telephone" class="block">Teléfono</label>
            <input type="text" id="telephone" formControlName="telephone" name="telephone"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="Teléfono" maxlength="9">
            <div
              *ngIf="employeeForm.get('telephone')?.errors?.['required'] && (employeeForm.get('telephone')?.dirty || employeeForm.get('telephone')?.touched)"
              class="text-red-500 mt-2">Teléfono es obligatorio.</div>
            <div
              *ngIf="employeeForm.get('telephone')?.errors?.['pattern'] && (employeeForm.get('telephone')?.dirty || employeeForm.get('telephone')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce solo números para el telefono.</div>
          </div>

          <div class="mt-2">

            <label for="photo">Foto</label>
            <input type="file" id="photo" formControlName="photo" (change)="onFileSelected($event)">
            <img *ngIf="selectedImageUrl" [src]="selectedImageUrl" alt="Selected Image" style="max-width: 200px;">
            <div
              *ngIf="employeeForm.get('photo')?.errors?.['required'] && (employeeForm.get('photo')?.dirty || employeeForm.get('photo')?.touched)"
              class="text-red-500 mt-2">Foto es obligatoria.</div>
            <div
              *ngIf="employeeForm.get('photo')?.errors?.['invalidImageExtension'] && (employeeForm.get('photo')?.dirty || employeeForm.get('photo')?.touched)"
              class="text-red-500 mt-2">La foto debe tener una extensión de archivo válida (jpg, jpeg, png).</div>
            <div *ngIf="employeeForm.get('photo')?.value && !employeeForm.get('photo')?.errors" class="text-green-500 mt-2">
              Foto válida.
            </div>
          </div>
        </div>
      </div>

      <!-- Address and Credentials -->
      <div class="flex-1 lg:ml-4">
        <div class="bg-white border border-black p-4 rounded-lg">
          <h2 class="text-lg font-bold">Direccion</h2>
          <hr class="my-2 border-gray-400">
          <div class="mt-2">
            <label for="street" class="block">Dirección</label>
            <input type="text" id="street" formControlName="street" name="street"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner mb-2" placeholder="Dirección"
              maxlength="150">
            <div
              *ngIf="employeeForm.get('street')?.errors?.['required'] && (employeeForm.get('street')?.dirty || employeeForm.get('street')?.touched)"
              class="text-red-500 mt-2">Dirección es obligatoria.</div>
          </div>
          <div class="mt-2">
            <label for="city" class="block">Ciudad</label>
            <input type="text" id="city" formControlName="city" name="city"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner mb-2" placeholder="Ciudad"
              maxlength="100">
            <div
              *ngIf="employeeForm.get('city')?.errors?.['required'] && (employeeForm.get('city')?.dirty || employeeForm.get('city')?.touched)"
              class="text-red-500 mt-2">Ciudad es obligatoria.</div>
              <div
              *ngIf="employeeForm.get('city')?.errors?.['pattern'] && (employeeForm.get('city')?.dirty || employeeForm.get('city')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce una ciudad correcta.</div>
          </div>

          <div class="mt-2">
            <label for="postal_code" class="block">Código Postal</label>
            <input type="text" id="cp" formControlName="postal_code" name="postal_code"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner mb-2" placeholder="Código Postal"
              maxlength="5">
            <div
              *ngIf="employeeForm.get('postal_code')?.errors?.['required'] && (employeeForm.get('postal_code')?.dirty || employeeForm.get('postal_code')?.touched)"
              class="text-red-500 mt-2">Código Postal es obligatorio.</div>
              <div *ngIf="employeeForm.get('postal_code')?.errors?.['minlength'] && (employeeForm.get('postal_code')?.dirty || employeeForm.get('postal_code')?.touched)"
               class="text-red-500 mt-2">El código postal debe tener exactamente 5 caracteres.</div>
            <div
              *ngIf="employeeForm.get('postal_code')?.errors?.['pattern'] && (employeeForm.get('postal_code')?.dirty || employeeForm.get('postal_code')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce solo números para el código postal.</div>
          </div>
        </div>
        <br>
        <div class="bg-white border border-black p-4 rounded-lg">
          <h2 class="text-lg font-bold">Credenciales</h2>
          <hr class="my-2 border-gray-400">
          <div class="mt-4">
            <label for="nif" class="block">NIF</label>
            <input type="text" id="nif" formControlName="nif" appNifValidator name="nif"
              class="border border-gray-300 rounded-md p-2 w-full shadow-inner" placeholder="12345678Z" maxlength="9">
              <div
              *ngIf="employeeForm?.get('nif')?.invalid && (employeeForm?.get('nif')?.dirty || employeeForm?.get('nif')?.touched)"
              class="text-red-500 mt-2">Por favor, introduce un NIF válido.</div>
              <div *ngIf="errorMessageNif" class="text-red-500 mt-2">{{ errorMessageNif }}</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Message error -->
    <div *ngIf="errorMessage" class="text-red-500 mt-2 text-center">
      {{ errorMessage }}
    </div>
    <div *ngIf="showErrorInvalid" class="text-red-500 mt-2 text-center">
      Error al editar empleado. Por favor, inténtelo de nuevo más tarde.
    </div>
    <!-- Button "Save" and "Cancel" -->
    <div class="mt-8 mb-3 flex justify-center">
      <button type="submit" [disabled]="!formModified" (click)="updatePhoto()"
        class="bg-green-500 hover:bg-green-700 text-white font-bold px-6 py-3 rounded-lg mr-4">Guardar</button>
        <button type="button" class="bg-gray-500 hover:bg-red-500 text-white font-bold px-6 py-3 rounded-lg" (click)="openModal()">
          Cancelar
        </button>
          </div>
  </form>
</div>

<app-cancelmodal (confirm)="confirmCancelEdit()" (cancel)="closeModal()"></app-cancelmodal>
